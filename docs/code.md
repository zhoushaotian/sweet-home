# 答辩
## 登录/注册模块
1. cookie和session的使用  
cookie存储在用户浏览器端，用户可以直接看到，因此不够安全。session存储在服务器端，本次系统中是由redis做session的存储。以redis作为session存储的好处: 速度快(数据存储在内存中) 有失效机制(session有过期时间)。  
在用户浏览器的cookie中我们只存储一个值，该值是session的一个索引(id)。每次请求我们网站的时候浏览器会发送该cookie，拿到cookie中存储的id之后就可以在redis中拿到对应的session信息。session信息中有该用户的所有关键信息，如用户的id等。每次访问的时候，如果拿到的session信息中有userid，则说明这次请求是已经登录过的。
由此可以知道登录的逻辑: 用户登录的时候发送用户名和密码，服务器拿到这两个关键数据之后查数据库，检查用户名和密码是否匹配。如果匹配则认证成功，向session中写入对应的用户信息。此时，则完成了登录过程。重定向请求到首页。  
注册的逻辑类似。不同的是，这次拿到用户发送过来的信息之后，不是查数据库进行校验，而是直接插入一条新的账户信息，然后再向对应的session中写入对应的账户信息，再重定向请求到首页。
2. 用redis做session的存储  
redis只是用来存储session，可以理解成第二个数据库。
3. 用户数据存储在user表中  
每次登陆的时候都需要查user表，然后比对用户名和密码是否正确。 注意：存储在user表中的用户密码是经过sha1加密过的，不是明文密码。这样会提高安全性，避免用户密码的泄露。
### Q/A（常见问题）
1. 什么是重定向
一个http请求发送到服务器之后，如果服务器需要对这个请求进行重定向，则会返回301/302的状态码，告诉浏览器，这个请求我收到了，但是需要你请求另外一个地址，浏览器收到回复之后，会再次请求一次新的地址，这个新的地址就是重定向的地址。
## 日历/事件模块
1. 进入首页会请求该用户和该用户情侣的所有事件  
去查事件表的时候是先查该用户的mate，然后再查事件表，根据事件表的createdBy字段和mate字段查出所有事件返回，这个事件数据会被前端存储。同理，写入事件的时候，会同时写入该事件创建的时候这个用户的userId和mate，分别写入createdBy和mate字段中。
2. 每次选择日期的时候会筛选事件表  
点击日期的时候会用选择的这个日期事件对前端请求的所有事件筛选出选择日期下的事件（根据事件中的time字段）
3. 事件表存储在events表中  
所有事件都存储在events表中，通过createdBy字段和mate字段与user表建立联系
### Q/A
1. 选择的日期和事件的时间是如何比较的  
用到了moment这个用来处理时间的js库。这个库暴露了很多方便的比较时间的api，例如:format、before、after等
## 邮件模块
邮件信息全部存储在mail表中，mail表中的sendTime这个字段是该邮件的发送时间，在服务器启动的时候会创建一个定时任务(setInterval)，该任务会每分钟检查mail表，将当前时间和mail表中的每一条的sendTime进行对比，如果相等，则说明这封邮件需要发出，邮件发送成功之后将isSend字段置为1，表明这封邮件已经发出。
